@model IEnumerable<Review_Web_App.Models.DTOs.PostResponseModel>
<link href="~/css/Search.css" rel="stylesheet" />
@{
   
    var message = ViewBag.Message as string;
    Layout = "_Layout1";
}

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert alert-info mb-4">
        @message
    </div>
}


<div class="search-form">
    <form asp-action="Search" asp-controller="Posts" method="post">
        <div class="form-group">
            <label for="title" class="control-label">Search by title:</label>
            <textarea id="title" name="title" placeholder="Search..." class="form-control" required></textarea>
        </div>

        <div class="form-group">
            <label for="categoryId" class="control-label">Category:</label>
            <select id="categoryId" name="categoryId" class="form-control">
                <option value="">Select a category</option>
                @foreach (var category in ViewBag.Categories as IEnumerable<SelectListItem>)
                {
                    <option value="@category.Value" selected="@(ViewContext.HttpContext.Request.Query["categoryId"] == category.Value)">
                        @category.Text
                    </option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Search</button>
    </form>
</div>


@if (Model != null && Model.Any())
{
    <div class="search-results">
        <h3>Search Results</h3>
        @foreach (var post in Model)
        {
            <div class="post-result">
                <h4>@post.PostTitle</h4>
                <p>@post.PostText</p>
                @if (!string.IsNullOrEmpty(post.PostFile))
                {
                    <img src="@Url.Content($"~/UploadedImages/{post.PostFile}")" alt="Post Image" style="max-width: 100%; height: auto;" />
                }
                <p>Reviewed by: @post.RevieweUsername</p>
                <p>Date Created: @post.DateCreated.ToString("MM/dd/yyyy")</p>
            </div>
            <div class="ViewPost">
                <form asp-action="Post" asp-controller="Posts" method="get" class="x-post__view-form">
                    <input type="hidden" name="id" value="@post.Id" />
                    <button type="submit" class="x-post__view-button">View Post</button>
                </form>
            </div>
        }
    </div>
}
else
{
    <p class="no-results">No results found</p>
}